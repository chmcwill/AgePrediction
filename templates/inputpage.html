{% extends "base.html" %}
{% block title %}Input Image Page{% endblock %}

{% block content %}
<h1 class = "title"> Age Predictor: How Old Do You Appear? </h1>

<div class = "outer">
    <div class = "inner">
        <form action="#" method="post" enctype="multipart/form-data" id="uploadForm">
            <h3 class = "center_p">Input an Image:</h3>
            <p>Images with one or more front facing faces in them will work.</p>
            <p><input type="file" name="file" accept="image/*"></p>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for msg in messages %}
                        <p style="color:red; font-weight:bold">{{msg}}</p>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <p>
                <input type="submit" name="submit" id="submitBtn"/>
                <span id="loadingSpinner" style="display:none; margin-left:10px;">
                    <i class="fa fa-spinner fa-spin fa-2x"></i>
                    <span>Processing...</span>
                </span>
            </p>
        </form>
        <script>
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            var submitBtn = document.getElementById('submitBtn');
            var spinner = document.getElementById('loadingSpinner');
            submitBtn.style.display = 'none';
            spinner.style.display = 'inline-block';
        });
        </script>
    </div>
</div>

<h3 class = "title">How does this work?</h3>
<p class = "left_p">I have trained a Convolutional Neural Network (CNN) on a cleaned version 
            of the IMDB-WIKI face dataset consisting of over 300,000 face age pairs.
            Data preprocessing first extracts the face from the image with 20% margin using a Multi Task
            CNN. The face is further rotated so that the eyes are horizontal to 
            enhance stability.</p>

<p class = "left_p">The model building process involved significant data preparation.
            About 1/3 of the images in the dataset were not helpful to train on 
            due to errors such as:</p>
<ul class = "left_p">
    <li>Images with no face in them</li>
    <li>Images with too small a face to be meaningful (less than 30 pixels)</li>
    <li>Images with a birth date after the picture was taken (negative age)</li>
    <li>Images where there are multiple faces, causing uncertainty as to who the age is for</li>
    <li>Images where the face is not fully visible (side profile)</li>
    <li>Images where the individual is clearly not the labeled age</li>
</ul>

<p class = "left_p">Images with the first 5 errors were removed before training an initial CNN.
                        The CNN was trained using a weighted sampler for equal representation of age.
                        Only ages 10 through 70 were used in training due to sparsity in the very young or old ages.
                        The initial CNN was then used to filter out the incorrectly labeled images
                        where the predicted age was off by more than 20 years. All of these data cleaning
                        steps increased performance of the final CNN on an independent and manually
                        cleaned test set.</p>

<p class = "left_p">A classification style approach to the regression problem is used for stability 
                        and interpretability. The expectation of the resulting probability 
                        distribution is taken for the prediction.</p>
                        
<p class = "left_p">The final result is an Age Prediction system that usually predicts
                        within 5 years of the true age. This is near human level performance for the task.
                        Higher resolution images usually perform better.
                        </p>

<div style="text-align: center">
    <h4 style="margin-right:.69cm; display:inline-block">Cameron McWilliams</h4>
    <a href="https://www.linkedin.com/in/cameron-mcwilliams-7aa036114/" style="color:black">
        <i class = "fa fa-linkedin fa-2x top2"></i>
    </a>
</div>

{% endblock %}